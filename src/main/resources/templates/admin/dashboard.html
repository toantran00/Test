<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - Pet Shop</title>

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<link rel="stylesheet" th:href="@{/css/admin/dashboard.css}">

</head>
<body>
	<div class="container-fluid">
		<div class="row">
			<!-- Sidebar -->
			<div th:replace="~{admin/fragments/navbar :: navbar}"></div>

			<!-- Main Content -->
			<main class="main-content">
				<!-- Header -->
				<div th:replace="~{admin/fragments/header :: header}"></div>

				<!-- Statistics Cards -->
				<div class="stats-container">
					<div class="row">
						<div class="col-xl-3 col-md-6">
							<div class="stat-card fade-in">
								<div class="d-flex justify-content-between align-items-center">
									<div>
										<div class="stat-number" th:text="${totalUsers}">0</div>
										<div class="stat-label">Tổng người dùng</div>
									</div>
									<i class="fas fa-users stat-icon"></i>
								</div>
							</div>
						</div>
						<div class="col-xl-3 col-md-6">
							<div class="stat-card fade-in">
								<div class="d-flex justify-content-between align-items-center">
									<div>
										<div class="stat-number" th:text="${totalStores}">0</div>
										<div class="stat-label">Cửa hàng</div>
									</div>
									<i class="fas fa-store stat-icon"></i>
								</div>
							</div>
						</div>
						<div class="col-xl-3 col-md-6">
							<div class="stat-card fade-in">
								<div class="d-flex justify-content-between align-items-center">
									<div>
										<div class="stat-number" th:text="${totalProducts}">0</div>
										<div class="stat-label">Sản phẩm</div>
									</div>
									<i class="fas fa-box stat-icon"></i>
								</div>
							</div>
						</div>
						<div class="col-xl-3 col-md-6">
							<div class="stat-card fade-in">
								<div class="d-flex justify-content-between align-items-center">
									<div>
										<div class="stat-number" th:text="${totalOrders}">0</div>
										<div class="stat-label">Đơn hàng</div>
									</div>
									<i class="fas fa-shopping-cart stat-icon"></i>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Recent Data -->
				<div class="data-sections">
					<div class="row">
						<!-- Recent Users -->
						<div class="col-md-6">
							<div class="section-card">
								<h5>
									<i class="fas fa-users"></i> Người dùng mới nhất
								</h5>
								<div class="list-group">
									<div th:each="user : ${recentUsers}"
										class="list-group-item border-0">
										<div class="d-flex w-100 justify-content-between align-items-center">
											<div style="flex: 1; min-width: 0; margin-right: 10px;">
												<h6 class="mb-1" th:text="${user.tenNguoiDung}">Tên người dùng</h6>
												<small class="text-muted" th:text="${user.email}">email@example.com</small>
											</div>
											<span class="badge"
												th:classappend="${user.vaiTro.maVaiTro == 'ADMIN'} ? 'bg-danger' : 'bg-secondary'"
												th:text="${user.vaiTro.tenVaiTro}">Vai trò</span>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Recent Stores -->
						<div class="col-md-6">
							<div class="section-card">
								<h5>
									<i class="fas fa-store"></i> Cửa hàng mới nhất
								</h5>
								<div class="list-group">
									<div th:each="store : ${recentStores}"
										class="list-group-item border-0">
										<div class="d-flex w-100 justify-content-between">
											<div style="flex: 1; min-width: 0; margin-right: 10px;">
												<h6 class="mb-1" th:text="${store.tenCuaHang}">Tên cửa hàng</h6>
												<small class="text-muted" th:text="${store.diaChi}">Địa chỉ</small>
											</div>
											<small class="text-muted"
												th:text="${#dates.format(store.ngayTao, 'dd/MM/yyyy')}">Ngày tạo</small>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="row mt-4">
						<!-- Recent Products -->
						<div class="col-md-6">
							<div class="section-card">
								<h5>
									<i class="fas fa-box"></i> Sản phẩm mới nhất
								</h5>
								<div class="list-group">
									<div th:each="product : ${recentProducts}"
										class="list-group-item border-0">
										<div class="d-flex w-100 justify-content-between">
											<div style="flex: 1; min-width: 0; margin-right: 10px;">
												<h6 class="mb-1" th:text="${product.tenSanPham}">Tên sản phẩm</h6>
												<small class="text-muted"
													th:text="'₫' + ${#numbers.formatDecimal(product.giaBan, 0, 'COMMA', 0, 'POINT')}">Giá</small>
											</div>
											<small class="text-muted"
												th:text="${product.cuaHang.tenCuaHang}">Cửa hàng</small>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Recent Orders -->
						<div class="col-md-6">
							<div class="section-card">
								<h5>
									<i class="fas fa-shopping-cart"></i> Đơn hàng mới nhất
								</h5>
								<div class="list-group">
									<div th:each="order : ${recentOrders}"
										class="list-group-item border-0">
										<div class="d-flex w-100 justify-content-between align-items-center">
											<div style="flex: 1; min-width: 0; margin-right: 10px;">
												<h6 class="mb-1" th:text="'Đơn #' + ${order.maDatHang}">Mã đơn</h6>
												<small class="text-muted"
													th:text="${order.nguoiDung.tenNguoiDung}">Khách hàng</small>
											</div>
											<span class="badge"
												th:classappend="${order.trangThai == 'New'} ? 'bg-primary' : 
																		   ${order.trangThai == 'Processing'} ? 'bg-warning' : 'bg-success'"
												th:text="${order.trangThai}">Trạng thái</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</main>
		</div>
	</div>

	<!-- Bootstrap JS -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

	<script>
	// Function để clear tất cả auth data
	function clearAuthData() {
		console.log('Clearing auth data...');
		
		// Clear localStorage
		localStorage.removeItem('jwtToken');
		localStorage.removeItem('user');
		
		// Clear sessionStorage
		sessionStorage.clear();
		
		// Xóa cookies
		document.cookie = "jwtToken=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;";
		document.cookie = "JSESSIONID=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;";
		
		console.log('Auth data cleared successfully');
	}
	
	// Add loading animation
	document.addEventListener('DOMContentLoaded', function() {
		console.log('Dashboard loaded - logout handlers attached');
		
		// Add fade-in animation to all cards
		const cards = document.querySelectorAll('.stat-card, .section-card');
		cards.forEach((card, index) => {
			card.style.animationDelay = `${index * 0.1}s`;
		});
	});
	</script>
</body>
</html>